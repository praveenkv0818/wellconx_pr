{% extends 'base.html' %}
{% block content %}
<div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-2xl font-bold mb-6">New Visit</h2>

    <form method="POST">
        {% csrf_token %}

        <!-- Select Patient (AJAX Search with Select2) -->
        <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-1">Patient</label>
            <select id="patient" name="patient" required style="width: 100%"></select>
        </div>

        <!-- Date -->
        <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-1">Visit Date</label>
            <input type="date" name="date" required
                   class="w-full border border-gray-300 rounded px-3 py-2 focus:ring focus:ring-blue-200">
        </div>

        <!-- Doctor -->
        <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-1">Doctor Name</label>
            <input type="text" name="doctor_name" placeholder="Dr. Smith" required
                   class="w-full border border-gray-300 rounded px-3 py-2 focus:ring focus:ring-blue-200">
        </div>

        <!-- Checkup Type -->
        <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-1">Checkup Type</label>
            <select name="checkup_type" required
                    class="w-full border border-gray-300 rounded px-3 py-2 focus:ring focus:ring-blue-200">
                <option value="Follow-up">Follow-up</option>
                <option value="Regular">Regular</option>
                <option value="New">New</option>
            </select>
        </div>

        <!-- Healthcare Service -->
        <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-1">Healthcare Service</label>
            <select name="healthcare_service" required
                    class="w-full border border-gray-300 rounded px-3 py-2 focus:ring focus:ring-blue-200">
                <option value="OPD">OPD</option>
                <option value="IPD">IPD</option>
                <option value="Emergency">Emergency</option>
            </select>
        </div>

        <!-- Vitals -->
        <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
                <label class="block text-gray-700 font-medium mb-1">Blood Pressure (BP)</label>
                <input type="text" name="bp" placeholder="120/80 mmHg" required
                       class="w-full border border-gray-300 rounded px-3 py-2 focus:ring focus:ring-blue-200">
            </div>
            <div>
                <label class="block text-gray-700 font-medium mb-1">Oxygen Level (%)</label>
                <input type="text" name="oxygen_level" placeholder="98%" required
                       class="w-full border border-gray-300 rounded px-3 py-2 focus:ring focus:ring-blue-200">
            </div>
        </div>

        <!-- Weight -->
        <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-1">Weight (kg)</label>
            <input type="number" step="0.01" name="weight" placeholder="70.50" required
                   class="w-full border border-gray-300 rounded px-3 py-2 focus:ring focus:ring-blue-200">
        </div>

        <!-- Notes -->
        <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-1">Visit Notes</label>
            <textarea name="notes" rows="4" placeholder="Describe symptoms, diagnosis, treatment, etc."
                      class="w-full border border-gray-300 rounded px-3 py-2 focus:ring focus:ring-blue-200"></textarea>
        </div>

        <!-- Submit -->
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
            Save Visit
        </button>
    </form>
</div>

<!-- Select2 Styles & Scripts -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
$(document).ready(function() {
    $('#patient').select2({
        placeholder: 'Search patient by name...',
        minimumInputLength: 1,
        ajax: {
            url: "{% url 'patient_search' %}",
            dataType: 'json',
            delay: 250,
            data: function(params) {
                return { term: params.term };
            },
            processResults: function(data) {
                return data;
            },
            cache: true
        },
        width: 'resolve'
    });
});
</script>
{% endblock %}
